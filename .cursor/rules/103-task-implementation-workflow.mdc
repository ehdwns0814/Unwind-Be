---
description: Task 구체화 및 구현 워크플로우 - 8단계 체계적 개발 프로세스
globs: tasks/**/*.md
alwaysApply: false
---
# Task Implementation Workflow

## Context
- 이 룰은 Backend 개발 Task를 구체화하고 구현하는 8단계 프로세스를 정의합니다
- Opus 4.5 모델(계획/분석)과 Composer1 모델(구현)의 역할을 분리합니다
- 3-Tier Architecture (Controller → Service → Repository) 기반 개발을 표준으로 합니다

## Model Responsibility Matrix

| 단계 | 작업 | 담당 모델 | 목적 |
|------|------|-----------|------|
| 1 | Backlog 조회 | Opus 4.5 | 작업 가능한 Task 식별 |
| 2 | 이슈 검토 | Opus 4.5 | 기술스택/요구사항 점검 |
| 3 | 이슈 문서 보완 | Opus 4.5 | 부족한 명세 보강 |
| 4 | 아키텍처 다이어그램 | Opus 4.5 | ERD, CLD, ORM 코드 추가 |
| 5 | GitHub 동기화 | Opus 4.5 | 이슈 티켓 업데이트 |
| 6 | 에이전트 계획 수립 | Opus 4.5 | Cursor Rules 기반 실행 계획 |
| 7 | 실제 구현 | Composer1 | 코드 작성 |
| 8 | 리뷰 문서 작성 | Opus 4.5 | 테스트 결과 정리 |

---

## Step 1: Backlog 조회 및 작업 선택

### 목적
- `tasks/github-issues/ISSUE_EXECUTION_GUIDE.md` 문서와 `gh` 명령어를 활용하여 Backlog에서 선행작업이 완료되어 현재 작업 가능한 Task를 식별합니다.

### 수행 작업
```bash
# Backlog 상태의 이슈 목록 조회
gh issue list --state open --json number,title,labels,projectItems

# Project Board에서 Backlog 컬럼 확인
gh project item-list <PROJECT_NUMBER> --owner <OWNER> --format json
```

### 선택 기준
1. **의존성 완료 여부**: 선행 작업(dependencies)이 모두 완료되었는지 확인
2. **Start Date 기준 정렬**: 가장 빠른 시작일을 가진 이슈 우선
3. **Priority 기준**: Must > Should > Could 순서

---

## Step 2: 이슈 검토 및 기술스택 점검

### 목적
- 선택한 작업의 GitHub 이슈가 현재 프로젝트 기술스택에 적합한 명세를 가지고 있는지 검토합니다.

### 검토 기준 항목

#### 필수 포함 사항
| 항목 | 설명 | 체크포인트 |
|------|------|------------|
| **Endpoint** | URI 및 HTTP Method | RESTful 원칙 준수 여부 |
| **Request Body** | 필드명, 타입, 필수 여부 | Validation 조건 명시 |
| **Response Body** | 성공/실패 시 응답 구조 | 표준 응답 포맷 준수 |
| **Logic Steps** | 데이터 처리 순서 | 중복검사 → 암호화 → 저장 등 |
| **Difficulty** | 예상 구현 난이도 | 상/중/하 표시 |

### 기술스택 참조
- `.cursor/rules/002-tech-stack.mdc` 파일을 참조하여 기술스택 호환성 검토

---

## Step 3: 이슈 문서 보완

### 목적
- Step 2에서 도출한 보완 방향에 맞추어 `tasks/github-issues/issue-XXX-*.md` 문서를 업데이트합니다.

### 보완 항목
1. **누락된 명세 추가**: Endpoint, Request/Response Body, Logic Steps
2. **Difficulty/Effort 재평가**: 작업 복잡도에 따른 조정
3. **Acceptance Criteria 구체화**: 완료 기준 명확화

---

## Step 4: 아키텍처 다이어그램 및 ORM 예제 코드 작성

### 목적
- 3-Tier 디자인 패턴(Repository → Service → Controller)에 따른 데이터 흐름을 명시합니다.

### 작성 항목

#### 4.1 ERD (Entity Relationship Diagram)
- **목적**: 데이터가 어떻게 저장될 것인가? (데이터베이스 관점)
- **형식**: Mermaid 다이어그램

```mermaid
erDiagram
    PARENT_TABLE ||--o{ CHILD_TABLE : has
    PARENT_TABLE {
        bigint id PK
        varchar name
        timestamp created_at
    }
    CHILD_TABLE {
        bigint id PK
        bigint parent_id FK
        varchar value
    }
```

#### 4.2 CLD (Class/Component Logic Diagram)
- **목적**: 데이터가 어떻게 가공될 것인가? (백엔드 서버 관점)
- **형식**: Mermaid Flowchart + Sequence Diagram

```mermaid
flowchart TB
    subgraph Controller["Controller Layer"]
        A[REST API Endpoint]
    end
    subgraph Service["Service Layer"]
        B[Business Logic]
    end
    subgraph Repository["Repository Layer"]
        C[JPA Repository]
    end
    subgraph Database["Database"]
        D[(MySQL)]
    end
    A --> B --> C --> D
```

#### 4.3 ORM 예제 코드
- **목적**: ERD와 CLD를 연결하는 실제 코드 생성
- **포함 내용**:
  - JPA Entity 클래스 전체 코드
  - Repository Interface 및 Query Methods
  - Service Layer 데이터 접근 예제

---

## Step 5: GitHub 이슈 동기화

### 목적
- 보완된 이슈 문서를 GitHub에 동기화합니다.

### 수행 작업
```bash
# 이슈 본문 업데이트
gh issue edit <ISSUE_NUMBER> --body "$(tail -n +3 tasks/github-issues/issue-XXX-*.md)"

# 이슈 상태를 In Progress로 변경 (중요!)
gh project item-edit \
  --id <ITEM_ID> \
  --project-id <PROJECT_ID> \
  --field-id <STATUS_FIELD_ID> \
  --single-select-option-id <IN_PROGRESS_OPTION_ID>
```

### ⚠️ 작업 시작 시 필수 상태 변경
- **반드시** 작업 시작 전에 이슈 상태를 `Backlog` → `In Progress`로 변경해야 합니다
- 이는 팀 내 작업 충돌 방지 및 진행 상황 가시성 확보를 위함입니다

---

## Step 6: 에이전트 계획 수립

### 목적
- `.cursor/rules/` 경로의 관련 룰을 스캔하여 작업 수행 계획을 수립합니다.

### 참조할 주요 Rules
| Rule 번호 | 파일명 | 용도 |
|-----------|--------|------|
| 200 | `200-git-commit-push-pr.mdc` | Git 커밋/PR 규칙 |
| 300 | `300-java-spring-cursor-rules.mdc` | Spring Boot 개발 규칙 |
| 302 | `302-jpa-querydsl-dynamic-query-rules.mdc` | JPA/QueryDSL 규칙 |
| 306 | `306-spring-boot-testing-rules.mdc` | 테스트 작성 규칙 |
| 307 | `307-api-design-exception-handling.mdc` | API 설계/예외처리 |

### 계획 수립 산출물
1. **파일 생성/수정 목록**: 어떤 파일들이 필요한지
2. **의존성 순서**: Entity → Repository → Service → Controller
3. **테스트 전략**: 단위 테스트 vs 통합 테스트 범위

---

## Step 7: 실제 구현 (Composer1 모델)

### 목적
- Step 6에서 수립한 계획에 따라 실제 코드를 작성합니다.

### 구현 순서 (3-Tier Architecture)
1. **Entity 생성**: Domain 모델 정의
2. **Repository 생성**: 데이터 접근 계층
3. **Flyway Migration**: DDL 스크립트
4. **Service 생성**: 비즈니스 로직 계층
5. **Controller 생성**: REST API 계층
6. **DTO 생성**: 요청/응답 객체
7. **Test 작성**: 각 계층별 테스트

### Git Workflow
```bash
# 1. Feature 브랜치 생성
git checkout -b feature/BE-XXX-task-name

# 2. 단계별 커밋 (Conventional Commits)
git commit -m "feat(entity): add XXX entity"
git commit -m "feat(repository): add XXX repository with query methods"
git commit -m "test(repository): add XXX repository integration tests"

# 3. Draft PR 생성
gh pr create --draft --title "[BE-XXX] Task Title" --body "..."

# 4. PR 준비 완료 후 Ready for Review
gh pr ready <PR_NUMBER>
```

---

## Step 8: 리뷰 문서 작성

### 목적
- PR 머지 후 구현 결과를 문서화합니다.

### 수행 작업
1. **main 브랜치로 이동**: `git checkout main && git pull origin main`
2. **리뷰 문서 생성**: `tasks/github-issues/docs-for-implementation-review/BE-XXX-implementation-review.md`

### 리뷰 문서 포함 내용
| 섹션 | 내용 |
|------|------|
| 작업 개요 | 태스크 제목, 관련 이슈 |
| 구현 상세 | 생성된 파일 목록, 주요 코드 스니펫 |
| 테스트 결과 | 테스트 실행 로그, 커버리지 |
| 아키텍처 준수 | 3-Tier 구조 준수 여부 |
| 후속 작업 | 관련 의존 작업 안내 |

### 이슈 정리
```bash
# 완료된 이슈 파일을 finished-issues로 이동
mv tasks/github-issues/issue-XXX-*.md tasks/github-issues/finished-issues/

# 리뷰 문서 커밋
git add tasks/github-issues/docs-for-implementation-review/BE-XXX-implementation-review.md
git commit -m "docs(review): add BE-XXX implementation review"
git push origin main
```

---

## Issue Status Management

### 상태 변경 시점

| 시점 | 이전 상태 | 이후 상태 | 수행 주체 |
|------|-----------|-----------|-----------|
| 작업 시작 시 | Backlog | **In Progress** | AI Agent (Step 5) |
| PR 생성 시 | In Progress | In Review | AI Agent (Step 7) |
| PR 머지 후 | In Review | Done | GitHub Automation 또는 수동 |

### 상태 변경 명령어
```bash
# In Progress로 변경
gh project item-edit \
  --id <ITEM_ID> \
  --project-id <PROJECT_ID> \
  --field-id <STATUS_FIELD_ID> \
  --single-select-option-id <IN_PROGRESS_OPTION_ID>
```

> **⚠️ 중요**: Step 5에서 작업을 시작하기 전 **반드시** 이슈 상태를 In Progress로 변경해야 합니다.
> 이를 통해 다른 팀원이나 AI Agent가 동일 작업을 중복으로 시작하는 것을 방지합니다.

---

## AI Agent Responsibilities

1. **Opus 4.5 모델**: Step 1~6, Step 8 수행 (분석, 계획, 문서화)
2. **Composer1 모델**: Step 7 수행 (실제 코드 구현)
3. **상태 관리**: 작업 시작 시 이슈 상태를 In Progress로 변경
4. **문서 동기화**: 로컬 이슈 문서와 GitHub 이슈 본문 동기화 유지
5. **완료 정리**: 머지 후 이슈 파일을 finished-issues로 이동

## Related Rules
- `100-error-fixing-process.mdc`: 오류 발생 시 진단 프로세스
- `200-git-commit-push-pr.mdc`: Git 커밋/PR 규칙
- `202-github-issue-handling.mdc`: GitHub 이슈 관리 규칙
- `300-java-spring-cursor-rules.mdc`: Spring Boot 개발 규칙
- `306-spring-boot-testing-rules.mdc`: 테스트 작성 규칙
